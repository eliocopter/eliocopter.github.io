<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Crypto MCP — More / Approfondimento</title>
  <meta name="description" content="Mock di progetto per Crypto MCP: Actor–Critic su Transformer Encoder, Gate, Oracle di simulazione, backend Java/Spring gRPC, UI React/TS con WebSocket, governance del rischio e osservabilità." />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css" />
  <style>
    /* Page‑specific tweaks */
    .hero.hero-slim{padding:48px 0 8px}
    .grid.cols-3{grid-template-columns:repeat(12,1fr)}
    .grid.cols-3>.card{grid-column:span 4}
    @media (max-width:880px){.grid.cols-3>.card{grid-column:span 12}}
    .mini{font-size:12px;color:var(--muted)}
    .lang-switch{display:flex;gap:6px}

    /* Media gallery */
    .gallery{display:grid;grid-template-columns:repeat(12,1fr);gap:16px}
    .gallery figure{grid-column:span 6;background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.03));border:1px solid rgba(255,255,255,.12);border-radius:16px;overflow:hidden;margin:0}
    .gallery figure img,.gallery figure video{display:block;width:100%;height:auto}
    .gallery figure figcaption{padding:10px 12px;color:var(--muted);font-size:13px}
    @media (max-width:880px){.gallery figure{grid-column:span 12}}

    /* Lightbox */
    #lightbox{border:none;border-radius:18px;max-width:min(1100px,96%);width:auto;padding:0;background:var(--card);color:var(--text);box-shadow:0 30px 60px rgba(0,0,0,.5)}
    #lightbox::backdrop{background:rgba(0,0,0,.6)}
    #lightbox .lb-head{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;border-bottom:1px solid rgba(255,255,255,.12)}
    #lightbox .lb-body{padding:0}
    #lightbox .lb-body img,#lightbox .lb-body video{display:block;width:100%;height:auto}
    #lightbox .lb-cap{padding:10px 14px;color:var(--muted);font-size:13px;border-top:1px solid rgba(255,255,255,.12)}
    #lb-close{border:1px solid rgba(255,255,255,.18);background:transparent;color:var(--text);border-radius:10px;padding:6px 10px}

    /* Spec list */
    .specs dt{font-weight:700}
    .specs dd{margin:0 0 10px 0;color:var(--muted)}
  </style>
</head>
<body>
  <header class="container header">
    <div class="logo"><div class="mark"><span class="dot"></span></div><div>Crypto MCP</div></div>
    <nav class="topnav" aria-label="secondary">
      <a href="index.html" data-i18n="nav.back">Home</a>
    </nav>
    <div class="lang-switch" role="group" aria-label="Language">
      <button class="chip" id="lang-it" aria-pressed="true">IT</button>
      <button class="chip" id="lang-en" aria-pressed="false">EN</button>
    </div>
  </header>

  <main class="container main">
    <section class="hero hero-slim">
      <div>
        <span class="badge" data-i18n="hero.badge">ML • Trading • gRPC • Observability</span>
        <h1 data-i18n="hero.title">Crypto MCP — Actor–Critic con Gate & Risk Policy</h1>
        <p class="lead" data-i18n="hero.lead">Piattaforma dimostrativa: Dataset→Oracle→Actor/Critic (Transformer), Gate su Score, backend Java 21/Spring Boot 3.5 via gRPC con controlli Pre‑Trade ed esecuzione su Testnet, UI React/TypeScript in tempo quasi reale con WebSocket, audit & metrica end‑to‑end.</p>
        <div class="cta">
          <a class="btn" href="#flussi" data-i18n="hero.cta.flows">Vedi i flussi</a>
          <a class="btn secondary" href="#architettura" data-i18n="hero.cta.arch">Architettura</a>
        </div>
      </div>
      
    </section>

    <section id="overview" class="section">
      <h2 data-i18n="overview.title">Overview</h2>
      <p class="muted" data-i18n="overview.text">Obiettivi: Fast‑Path regolare decisione→ordine, Explainability & Governance del rischio, riproducibilità/Audit. Punti chiave: Critic con Score s=P(Good)−P(Bad) e soglie per‑azione (Gate), Actor con proposta e parametri, UI che riflette proposta→Gate→ordine ed esiti.</p>
      <div class="grid cols-3">
        <article class="card">
          <div class="pad">
            <div class="subtitle" data-i18n="overview.cards.models.subtitle">Modelli</div>
            <div class="title" data-i18n="overview.cards.models.title">Transformer Encoder</div>
            <p class="muted" data-i18n="overview.cards.models.body">Critic: classificazione Good/Neutral/Bad + stima PnL ausiliaria. Actor: azione + parametri (Horizon, Size, SL_ATR, Leverage) con distillazione della policy.</p>
            <span class="pill">Encoder‑Only</span> <span class="pill">Multi‑Head</span>
          </div>
        </article>
        <article class="card">
          <div class="pad">
            <div class="subtitle" data-i18n="overview.cards.backend.subtitle">Backend</div>
            <div class="title" data-i18n="overview.cards.backend.title">Java 21 • Spring 3.5</div>
            <p class="muted" data-i18n="overview.cards.backend.body">gRPC/REST, Virtual Threads, controlli Pre‑Trade, idempotenza e instradamento ordini verso Testnet. UI React/TS con WebSocket.</p>
            <span class="pill">gRPC</span> <span class="pill">WebSocket</span>
          </div>
        </article>
        <article class="card">
          <div class="pad">
            <div class="subtitle" data-i18n="overview.cards.gov.subtitle">Governance</div>
            <div class="title" data-i18n="overview.cards.gov.title">Rischio & Audit</div>
            <p class="muted" data-i18n="overview.cards.gov.body">Soglie runtime, Kill/Pausa, Rate‑Limit, Retry/Backoff, Audit Trail su SQLite con Correlation‑ID e metriche di Drift/Pass‑Rate.</p>
            <span class="pill">Kill‑Switch</span> <span class="pill">Audit</span>
          </div>
        </article>
      </div>
    </section>

    <section id="flussi" class="section">
      <h2 data-i18n="flows.title">Flussi utente</h2>
      <div class="grid">
        <article class="card" style="grid-column:span 6">
          <div class="mock">
            <svg viewBox="0 0 640 360" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Sessione & calibrazione">
              <rect x="24" y="24" width="592" height="312" rx="18" fill="#0f1422" stroke="#3b82f6"/>
              <rect x="56" y="60" width="528" height="72" rx="10" fill="#141a2a"/>
              <rect x="56" y="148" width="528" height="150" rx="10" fill="#141a2a"/>
              <text x="66" y="104" font-family="Inter" font-size="16" fill="#8b93a7">Avvio sessione & profilo rischio</text>
              <text x="66" y="190" font-family="Inter" font-size="16" fill="#8b93a7">Soglie Gate (BUY/SELL) & confidenze</text>
            </svg>
          </div>
          <div class="pad">
            <div class="title" data-i18n="flows.cards.session.title">Avvio sessione & soglie</div>
            <p class="muted" data-i18n="flows.cards.session.body">Selezione coppie, profilo rischio, calibrazione soglie Gate per BUY/SELL e confidenze Actor; salvataggio versione modelli/configurazioni.</p>
          </div>
        </article>
        <article class="card" style="grid-column:span 6">
          <div class="mock">
            <svg viewBox="0 0 640 360" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Proposte & Gate">
              <rect x="24" y="24" width="592" height="312" rx="18" fill="#0f1422" stroke="#22d3ee"/>
              <rect x="56" y="60" width="528" height="72" rx="10" fill="#141a2a"/>
              <rect x="56" y="148" width="250" height="150" rx="10" fill="#141a2a"/>
              <rect x="334" y="148" width="250" height="150" rx="10" fill="#141a2a"/>
              <text x="66" y="104" font-family="Inter" font-size="16" fill="#8b93a7">Stream proposte</text>
              <text x="66" y="180" font-family="Inter" font-size="16" fill="#8b93a7">Gate Critic (Score)</text>
              <text x="344" y="180" font-family="Inter" font-size="16" fill="#8b93a7">Azioni filtrate</text>
            </svg>
          </div>
          <div class="pad">
            <div class="title" data-i18n="flows.cards.gate.title">Proposte → Gate</div>
            <p class="muted" data-i18n="flows.cards.gate.body">L’Actor propone BUY/SELL/HOLD; il Critic valuta e applica il Gate per‑azione su Score; solo i segnali sopra soglia proseguono.</p>
          </div>
        </article>
        <article class="card" style="grid-column:span 6">
          <div class="mock">
            <svg viewBox="0 0 640 360" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Pre‑Trade & ordine">
              <rect x="24" y="24" width="592" height="312" rx="18" fill="#0f1422" stroke="#a78bfa"/>
              <rect x="56" y="60" width="528" height="220" rx="10" fill="#141a2a"/>
              <text x="66" y="96" font-family="Inter" font-size="16" fill="#8b93a7">Pre‑Trade: limiti, tick size, margine, idempotenza</text>
            </svg>
          </div>
          <div class="pad">
            <div class="title" data-i18n="flows.cards.order.title">Controlli & ordine</div>
            <p class="muted" data-i18n="flows.cards.order.body">Backend gRPC effettua controlli Pre‑Trade e instrada l’ordine verso Testnet; conferme e riempimenti tornano alla Dashboard in tempo reale.</p>
          </div>
        </article>
        <article class="card" style="grid-column:span 6">
          <div class="mock">
            <svg viewBox="0 0 640 360" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Pausa/Kill & export">
              <rect x="24" y="24" width="592" height="312" rx="18" fill="#0f1422" stroke="#34d399"/>
              <rect x="56" y="60" width="528" height="220" rx="10" fill="#141a2a"/>
              <text x="66" y="96" font-family="Inter" font-size="16" fill="#8b93a7">Pausa, Kill‑Switch, export JSONL/Parquet</text>
            </svg>
          </div>
          <div class="pad">
            <div class="title" data-i18n="flows.cards.ops.title">Operatività & analisi</div>
            <p class="muted" data-i18n="flows.cards.ops.body">Pausa/Kill immediati; esportazione per analisi e audit; auto‑calibrazione soglie; metriche drift e pass‑rate in UI.</p>
          </div>
        </article>
      </div>
    </section>
    <section id="media" class="section">
      <h2 data-i18n="media.title">Media</h2>
      <p class="muted" data-i18n="media.desc">GIF e screenshot della Dashboard. Clicca per ingrandire.</p>
      <div class="gallery" id="gallery"></div>
    </section>
    <section id="architettura" class="section">
      <h2 data-i18n="arch.title">Architettura (alto livello)</h2>
      <div class="grid">
        <article class="card" style="grid-column:span 12">
          <div class="pad">
            <div class="title" data-i18n="arch.chain.title">Vista di contesto & sequenza</div>
            <p class="muted" data-i18n="arch.chain.body">UI ↔ Backend (REST per chiamate puntuali, WebSocket per stream quasi‑reale). Backend ↔ servizi ML (gRPC tipizzati). Sequenza end‑to‑end: proposta → Gate → Pre‑Trade → ordine → esiti; in parallelo Risk‑Watcher per uscite rapide; tutto tracciato da Correlation‑ID.</p>
            <div class="tags"><span class="tag">REST</span> <span class="tag">WebSocket</span> <span class="tag">gRPC</span></div>
          </div>
        </article>
      </div>
    </section>

    <section id="modelli" class="section">
      <h2 data-i18n="models.title">Modelli: Critic & Actor</h2>
      <div class="grid">
        <article class="card" style="grid-column:span 6">
          <div class="pad">
            <div class="title" data-i18n="models.critic.title">Critic (Encoder‑Only)</div>
            <p class="muted" data-i18n="models.critic.body">6 layer Encoder, d=256, 8 head; input: sequenza [T,F] + embedding Pair/Azione + statics via MLP; output: {Good, Neutral, Bad} e Score s=P(Good)−P(Bad); testa ausiliaria per PnL atteso.</p>
            <div class="tags"><span class="tag">Self‑Attention</span> <span class="tag">Aux‑Head</span></div>
          </div>
        </article>
        <article class="card" style="grid-column:span 6">
          <div class="pad">
            <div class="title" data-i18n="models.actor.title">Actor (Policy distillata)</div>
            <p class="muted" data-i18n="models.actor.body">Multi‑Task: azione (BUY/SELL con astensione HOLD per bassa confidenza) + parametri (Leverage, Position%, SL_ATR, Horizon). Distillazione da Critic con KL su Soft Targets (temperatura) + CE su argmax.</p>
            <div class="tags"><span class="tag">KD</span> <span class="tag">Reject‑Option</span></div>
          </div>
        </article>
      </div>
    </section>

    <section id="dataset" class="section">
      <h2 data-i18n="data.title">Dataset & Oracle</h2>
      <p class="muted" data-i18n="data.body">Storici in Parquet→JSONL (Train/Val/Test), finestra 1H con Feature OHLC, EMA12/26, RSI14, ATR14, ret1. Oracle calcola PnL con Fees+Slippage proporzionale ad ATR; labeling BUY/SELL a quantili (p20/p60) e HOLD opportunity‑aware.</p>
    </section>

    <section id="backend" class="section">
      <h2 data-i18n="backend.title">Backend & Interfacce</h2>
      <ul class="muted">
        <li data-i18n="backend.items.grpc"><strong>gRPC Java/Spring</strong>: contratti versionati, Virtual Threads, idempotenza, Retry/Backoff, Circuit‑Breaker e Rate‑Limit.</li>
        <li data-i18n="backend.items.pretrade"><strong>Pre‑Trade</strong>: limiti, tick size, leve massime, filtri Exchange, margine disponibile.</li>
        <li data-i18n="backend.items.ui"><strong>UI React/TS</strong>: Firebase Auth (JWT), SQLite locale per persistenza demo, stream WebSocket.</li>
        <li data-i18n="backend.items.audit"><strong>Audit</strong>: ordini/esecuzioni, versioni modelli, soglie e configurazioni con Correlation‑ID.</li>
      </ul>
    </section>

    <section id="rischio" class="section">
      <h2 data-i18n="risk.title">Rischio & Governance</h2>
      <p class="muted" data-i18n="risk.body">Gate per‑azione, filtri di contesto (RSI/volatilità), profili di direzione consentita (solo Long/Short), cap su leva e size, limite posizioni attive, cooldown per ri‑aperture, SL basato su ATR e orizzonte massimo, Take‑Profit/Trailing. Pausa/Kill. Configurazioni modificabili a runtime con eventi tracciati.</p>
    </section>

    <section id="observability" class="section">
      <h2 data-i18n="obs.title">Observability</h2>
      <p class="muted" data-i18n="obs.body">Metriche tecniche (latenze per tratto, error‑rate, ampiezza code) e di modello (distribuzione Score, pass‑rate del Gate, drift); Log strutturati correlati da Correlation‑ID; dashboard in tempo quasi reale.</p>
    </section>



    <footer>
      © <span id="y"></span> • <span data-i18n="footer.tail">Euplio Lisi Portfolio</span>
    </footer>
  </main>

  <dialog id="lightbox">
    <div class="lb-head">
      <strong id="lb-title">Crypto MCP</strong>
      <button id="lb-close">Close</button>
    </div>
    <div class="lb-body">
      <img id="lb-img" alt="" style="display:none"/>
      <video id="lb-video" autoplay muted loop playsinline controls style="display:none"></video>
    </div>
    <div class="lb-cap" id="lb-cap"></div>
  </dialog>

  <script>
  // --- Minimal i18n + gallery for this page ---
  const I18N = {
    it: {
      nav: { back: 'Home' },
      hero: { badge: 'ML • Trading • gRPC • Observability', title: 'Crypto MCP — Actor–Critic con Gate & Risk Policy', lead: 'Piattaforma dimostrativa: Dataset→Oracle→Actor/Critic (Transformer), Gate su Score, backend Java 21/Spring Boot 3.5 via gRPC con controlli Pre‑Trade ed esecuzione su Testnet, UI React/TypeScript in tempo quasi reale con WebSocket, audit & metrica end‑to‑end.', cta: { flows: 'Vedi i flussi', arch: 'Architettura' } },
      overview: {
        title: 'Overview',
        text: 'Obiettivi: Fast‑Path regolare decisione→ordine, Explainability & Governance del rischio, riproducibilità/Audit. Punti chiave: Critic con Score s=P(Good)−P(Bad) e soglie per‑azione (Gate), Actor con proposta e parametri, UI che riflette proposta→Gate→ordine ed esiti.',
        cards: {
          models: { subtitle: 'Modelli', title: 'Transformer Encoder', body: 'Critic: classificazione Good/Neutral/Bad + stima PnL ausiliaria. Actor: azione + parametri (Horizon, Size, SL_ATR, Leverage) con distillazione della policy.' },
          backend: { subtitle: 'Backend', title: 'Java 21 • Spring 3.5', body: 'gRPC/REST, Virtual Threads, controlli Pre‑Trade, idempotenza e instradamento ordini verso Testnet. UI React/TS con WebSocket.' },
          gov: { subtitle: 'Governance', title: 'Rischio & Audit', body: 'Soglie runtime, Kill/Pausa, Rate‑Limit, Retry/Backoff, Audit Trail su SQLite con Correlation‑ID e metriche di Drift/Pass‑Rate.' }
        }
      },
      flows: {
        title: 'Flussi utente',
        cards: {
          session: { title: 'Avvio sessione & soglie', body: 'Selezione coppie, profilo rischio, calibrazione soglie Gate per BUY/SELL e confidenze Actor; salvataggio versione modelli/configurazioni.' },
          gate: { title: 'Proposte → Gate', body: 'L’Actor propone BUY/SELL/HOLD; il Critic valuta e applica il Gate per‑azione su Score; solo i segnali sopra soglia proseguono.' },
          order: { title: 'Controlli & ordine', body: 'Backend gRPC effettua controlli Pre‑Trade e instrada l’ordine verso Testnet; conferme e riempimenti tornano alla Dashboard in tempo reale.' },
          ops: { title: 'Operatività & analisi', body: 'Pausa/Kill immediati; esportazione per analisi e audit; auto‑calibrazione soglie; metriche drift e pass‑rate in UI.' }
        }
      },
      arch: { title: 'Architettura (alto livello)', chain: { title: 'Vista di contesto & sequenza', body: 'UI ↔ Backend (REST per chiamate puntuali, WebSocket per stream quasi‑reale). Backend ↔ servizi ML (gRPC tipizzati). Sequenza end‑to‑end: proposta → Gate → Pre‑Trade → ordine → esiti; in parallelo Risk‑Watcher per uscite rapide; tutto tracciato da Correlation‑ID.' } },
      models: { title: 'Modelli: Critic & Actor', critic: { title: 'Critic (Encoder‑Only)', body: '6 layer Encoder, d=256, 8 head; input: sequenza [T,F] + embedding Pair/Azione + statics via MLP; output: {Good, Neutral, Bad} e Score s=P(Good)−P(Bad); testa ausiliaria per PnL atteso.' }, actor: { title: 'Actor (Policy distillata)', body: 'Multi‑Task: azione (BUY/SELL con astensione HOLD per bassa confidenza) + parametri (Leverage, Position%, SL_ATR, Horizon). Distillazione da Critic con KL su Soft Targets (temperatura) + CE su argmax.' } },
      data: { title: 'Dataset & Oracle', body: 'Storici in Parquet→JSONL (Train/Val/Test), finestra 1H con Feature OHLC, EMA12/26, RSI14, ATR14, ret1. Oracle calcola PnL con Fees+Slippage proporzionale ad ATR; labeling BUY/SELL a quantili (p20/p60) e HOLD opportunity‑aware.' },
      backend: { title: 'Backend & Interfacce', items: { grpc: '<strong>gRPC Java/Spring</strong>: contratti versionati, Virtual Threads, idempotenza, Retry/Backoff, Circuit‑Breaker e Rate‑Limit.', pretrade: '<strong>Pre‑Trade</strong>: limiti, tick size, leve massime, filtri Exchange, margine disponibile.', ui: '<strong>UI React/TS</strong>: Firebase Auth (JWT), SQLite locale per persistenza demo, stream WebSocket.', audit: '<strong>Audit</strong>: ordini/esecuzioni, versioni modelli, soglie e configurazioni con Correlation‑ID.' } },
      risk: { title: 'Rischio & Governance', body: 'Gate per‑azione, filtri di contesto (RSI/volatilità), profili di direzione consentita (solo Long/Short), cap su leva e size, limite posizioni attive, cooldown per ri‑aperture, SL basato su ATR e orizzonte massimo, Take‑Profit/Trailing. Pausa/Kill. Configurazioni modificabili a runtime con eventi tracciati.' },
      obs: { title: 'Observability', body: 'Metriche tecniche (latenze per tratto, error‑rate, ampiezza code) e di modello (distribuzione Score, pass‑rate del Gate, drift); Log strutturati correlati da Correlation‑ID; dashboard in tempo quasi reale.' },
      media: { title: 'Media', desc: 'GIF e screenshot della Dashboard: proposte/Score, Gate e soglie, Pre‑Trade, ordini ed esiti, pannello metriche. Clicca per ingrandire.' },
      footer: { tail: 'More about Crypto MCP' }
    },
    en: {
      nav: { back: 'Home' },
      hero: { badge: 'ML • Trading • gRPC • Observability', title: 'Crypto MCP — Actor–Critic with Gate & Risk Policy', lead: 'Demonstration platform: Dataset→Oracle→Actor/Critic (Transformer), Gate on Score, Java 21/Spring Boot 3.5 backend via gRPC with Pre‑Trade checks and Testnet execution, React/TypeScript UI with near‑real‑time WebSocket, audit & end‑to‑end metrics.', cta: { flows: 'See flows', arch: 'Architecture' } },
      overview: {
        title: 'Overview',
        text: 'Goals: regular decision→order Fast‑Path, Explainability & Risk Governance, reproducibility/Audit. Key points: Critic with Score s=P(Good)−P(Bad) and per‑action thresholds (Gate), Actor with proposal & parameters, UI mirroring proposal→Gate→order and outcomes.',
        cards: {
          models: { subtitle: 'Models', title: 'Transformer Encoder', body: 'Critic: Good/Neutral/Bad classification + auxiliary PnL estimate. Actor: action + parameters (Horizon, Size, SL_ATR, Leverage) with policy distillation.' },
          backend: { subtitle: 'Backend', title: 'Java 21 • Spring 3.5', body: 'gRPC/REST, Virtual Threads, Pre‑Trade checks, idempotency and order routing to Testnet. React/TS UI with WebSocket.' },
          gov: { subtitle: 'Governance', title: 'Risk & Audit', body: 'Runtime thresholds, Kill/Pause, Rate‑Limit, Retry/Backoff, SQLite Audit Trail with Correlation‑ID and Drift/Pass‑Rate metrics.' }
        }
      },
      flows: {
        title: 'User flows',
        cards: {
          session: { title: 'Session start & thresholds', body: 'Pick pairs, risk profile, calibrate Gate thresholds for BUY/SELL and Actor confidences; persist model/config versions.' },
          gate: { title: 'Proposals → Gate', body: 'Actor proposes BUY/SELL/HOLD; Critic evaluates and applies per‑action Gate on Score; only above‑threshold signals proceed.' },
          order: { title: 'Checks & order', body: 'gRPC Backend performs Pre‑Trade checks and routes the order to Testnet; confirmations & fills stream back to the Dashboard.' },
          ops: { title: 'Operations & analysis', body: 'Immediate Pause/Kill; export for analysis/audit; auto‑calibration of thresholds; drift and pass‑rate metrics in UI.' }
        }
      },
      arch: { title: 'Architecture (high level)', chain: { title: 'Context & sequence view', body: 'UI ↔ Backend (REST for point calls, WebSocket for near‑real‑time stream). Backend ↔ ML services (typed gRPC). End‑to‑end sequence: proposal → Gate → Pre‑Trade → order → outcomes; Risk‑Watcher in parallel; all correlated by a Correlation‑ID.' } },
      models: { title: 'Models: Critic & Actor', critic: { title: 'Critic (Encoder‑Only)', body: '6 Encoder layers, d=256, 8 heads; input: sequence [T,F] + Pair/Action embeddings + statics via MLP; output: {Good, Neutral, Bad} and Score s=P(Good)−P(Bad); auxiliary head for expected PnL.' }, actor: { title: 'Actor (Distilled policy)', body: 'Multi‑Task: action (BUY/SELL with HOLD abstention under low confidence) + parameters (Leverage, Position%, SL_ATR, Horizon). Distilled from Critic with KL on Soft Targets (temperature) + CE on argmax.' } },
      data: { title: 'Dataset & Oracle', body: 'Historical Parquet→JSONL (Train/Val/Test), 1H window with OHLC, EMA12/26, RSI14, ATR14, ret1. Oracle computes PnL with Fees+ATR‑proportional Slippage; BUY/SELL labeling by quantiles (p20/p60) and opportunity‑aware HOLD.' },
      backend: { title: 'Backend & Interfaces', items: { grpc: '<strong>gRPC Java/Spring</strong>: versioned contracts, Virtual Threads, idempotency, Retry/Backoff, Circuit‑Breaker and Rate‑Limit.', pretrade: '<strong>Pre‑Trade</strong>: limits, tick size, max leverage, Exchange filters, available margin.', ui: '<strong>React/TS UI</strong>: Firebase Auth (JWT), local SQLite for demo persistence, WebSocket stream.', audit: '<strong>Audit</strong>: orders/fills, model versions, thresholds and configurations with Correlation‑ID.' } },
      risk: { title: 'Risk & Governance', body: 'Per‑action Gate, context filters (RSI/volatility), allowed direction profiles (Long‑only/Short‑only), caps on leverage and size, active positions limit, cooldown for re‑entries, ATR‑based SL and max horizon, Take‑Profit/Trailing. Pause/Kill. Runtime‑mutable configs with tracked events.' },
      obs: { title: 'Observability', body: 'Technical metrics (per‑leg latencies, error‑rate, queue depth) and model metrics (Score distribution, Gate pass‑rate, drift); structured logs with Correlation‑ID; near‑real‑time dashboard.' },
      media: { title: 'Media', desc: 'GIFs and screenshots of the Dashboard. Click to enlarge.' },
      footer: { tail: 'More about Crypto MCP' }
    }
  };

  // --- Media items (replace src with your files) ---
  const MEDIA = [
    { type: 'img', src: 'media/homepage-vuota.png', w: 1600, h: 900, i18n: { it: { cap: 'Homepage' }, en: { cap: 'Homepage' } } },
    { type: 'img', src: 'media/homepage.png', w: 1600, h: 900, i18n: { it: { cap: 'Vista sessioni' }, en: { cap: 'Sessions overview' } } },
    { type: 'img', src: 'media/nuova-sessione.png', w: 1600, h: 900, i18n: { it: { cap: 'Nuova sessione' }, en: { cap: 'New session' } } },
    { type: 'img', src: 'media/session.png', w: 1600, h: 900, i18n: { it: { cap: 'Dettaglio per sessione' }, en: { cap: 'Orders & Session control' } } },
    // Example video: { type: 'video', src: 'media/mcp-loop.mp4', w:1920, h:1080, i18n:{it:{cap:'Fast‑Path decisione→ordine'}, en:{cap:'Decision→order Fast‑Path'}} }
  ];

  function $all(sel, root=document){ return [...root.querySelectorAll(sel)]; }
  function applyI18N(lang){
    const dict = I18N[lang];
    document.documentElement.setAttribute('lang', lang);
    $all('[data-i18n]').forEach(el => {
      const path = el.getAttribute('data-i18n').split('.');
      let val = dict; for(const k of path){ val = val?.[k]; }
      if(typeof val === 'string'){ el.innerHTML = val; }
    });
  }

  function renderGallery(lang){
    const g = document.getElementById('gallery');
    g.innerHTML = '';
    MEDIA.forEach((m, idx)=>{
      const fig = document.createElement('figure');
      fig.innerHTML = `
        ${m.type==='img' ? `<img src="${m.src}" alt="${m.i18n[lang].cap}" loading="lazy" width="${m.w}" height="${m.h}">` : `<video src="${m.src}" muted playsinline preload="metadata"></video>`}
        <figcaption>${m.i18n[lang].cap}</figcaption>`;
      fig.addEventListener('click', ()=> openLightbox(idx, lang));
      g.appendChild(fig);
    });
  }

  const lb = document.getElementById('lightbox');
  const lbImg = document.getElementById('lb-img');
  const lbVideo = document.getElementById('lb-video');
  const lbCap = document.getElementById('lb-cap');
  document.getElementById('lb-close').addEventListener('click', ()=> lb.close());
  window.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && lb.open) lb.close(); });

  function openLightbox(index, lang){
    const m = MEDIA[index];
    lbImg.style.display = 'none';
    lbVideo.style.display = 'none';
    if(m.type==='img'){
      lbImg.src = m.src; lbImg.alt = m.i18n[lang].cap; lbImg.style.display='block';
    } else {
      lbVideo.src = m.src; lbVideo.style.display='block'; lbVideo.play();
    }
    lbCap.textContent = m.i18n[lang].cap;
    document.getElementById('lb-title').textContent = 'Crypto MCP';
    lb.showModal();
  }

  function setLang(lang){
    localStorage.setItem('cryptomcp_lang', lang);
    document.getElementById('lang-it').setAttribute('aria-pressed', String(lang==='it'));
    document.getElementById('lang-en').setAttribute('aria-pressed', String(lang==='en'));
    applyI18N(lang);
    renderGallery(lang);
  }
  document.getElementById('lang-it').addEventListener('click', ()=> setLang('it'));
  document.getElementById('lang-en').addEventListener('click', ()=> setLang('en'));

  // Init
  (function(){
    document.getElementById('y').textContent = new Date().getFullYear();
    const lang = localStorage.getItem('cryptomcp_lang') || (localStorage.getItem('lang')||'it');
    setLang(lang);
  })();
  </script>
</body>
</html>